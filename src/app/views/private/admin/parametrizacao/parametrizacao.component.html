<form [formGroup]="form">
  <div formArrayName="modulos">
    <div *ngFor="let modulo of getFormArray(); let m = index" class="mb-4">
      <ngb-accordion #acc="ngbAccordion" class="bg-primary">
        <ngb-panel
          [title]="
            modulo.get('nome')!.value != ''
              ? modulo.get('nome')!.value
              : 'Novo Modulo ' + (m + 1)
          "
        >
          <ng-template ngbPanelContent [formGroupName]="m">
            <div class="d-flex justify-content-end px-4">
              <button
                class="btn btn-outline-danger endButton"
                (click)="deleteModulo(m)"
              >
                Deletar
              </button>
            </div>
            <div class="row px-4">
              <div class="form-floating form-group my-3 col-lg-5 col-md-12">
                <input
                  type="text"
                  required
                  maxlength="100"
                  class="form-control text-black"
                  id="floatingInput"
                  placeholder="Jogo"
                  formControlName="nome"
                />
                <label for="floatingInput">Nome</label>
              </div>
              <div class="form-floating form-group my-3 col-lg-5 col-md-12">
                <input
                  type="text"
                  required
                  maxlength="100"
                  class="form-control text-black"
                  id="floatingInput"
                  placeholder="Jogo"
                  formControlName="icone"
                />
                <label for="floatingInput">Icone</label>
              </div>
              <div class="form-floating form-group my-3 col-lg-7 col-md-12">
                <input
                  type="text"
                  maxlength="100"
                  class="form-control text-black"
                  id="floatingInput"
                  placeholder="Jogo"
                  formControlName="path"
                />
                <label for="floatingInput">Link</label>
              </div>
              <div class="form-floating form-group my-3 col-lg-4 col-md-12">
                <select
                  class="form-select text-black"
                  id="exampleSelect1"
                  formControlName="ativo"
                >
                  <option [value]="false">Desabilitado</option>
                  <option [value]="true">Habilitado</option>
                </select>
                <label for="floatingInput">Acesso</label>
              </div>
            </div>
            <hr class="text-black-50" />
            <div class="px-4">
              <h4 class="fw-bold py-4 text-uppercase">Itens</h4>
              <div formArrayName="itens" *ngIf="getItemFormArray(m).length > 0">
                <div
                  *ngFor="let item of getItemFormArray(m); let i = index"
                  class="mb-4"
                >
                  <ngb-accordion #acc="ngbAccordion" class="bg-primary">
                    <ngb-panel
                      [title]="
                        item.get('nome')!.value != ''
                          ? item.get('nome')!.value
                          : 'Novo Item ' + (i + 1)
                      "
                    >
                      <ng-template ngbPanelContent>
                        <div class="d-flex justify-content-end px-4">
                          <button
                            class="btn btn-outline-danger endButton"
                            (click)="deleteItem(m, i)"
                          >
                            Deletar Item
                          </button>
                        </div>
                        <div class="row px-4" [formGroupName]="i">
                          <div
                            class="form-floating form-group my-3 col-lg-5 col-md-12"
                          >
                            <input
                              type="text"
                              required
                              maxlength="100"
                              class="form-control text-black"
                              id="floatingInput"
                              placeholder="Jogo"
                              formControlName="nome"
                            />
                            <label for="floatingInput">Nome</label>
                          </div>
                          <div
                            class="form-floating form-group my-3 col-lg-5 col-md-12"
                          >
                            <input
                              type="text"
                              required
                              maxlength="100"
                              class="form-control text-black"
                              id="floatingInput"
                              placeholder="Jogo"
                              formControlName="icone"
                            />
                            <label for="floatingInput">Icone</label>
                          </div>
                          <div
                            class="form-floating form-group my-3 col-lg-7 col-md-12"
                          >
                            <input
                              type="text"
                              maxlength="100"
                              class="form-control text-black"
                              id="floatingInput"
                              placeholder="Jogo"
                              formControlName="path"
                            />
                            <label for="floatingInput">Link</label>
                          </div>
                          <div
                            class="form-floating form-group my-3 col-lg-4 col-md-12"
                          >
                            <select
                              class="form-select text-black"
                              id="exampleSelect1"
                              formControlName="ativo"
                            >
                              <option [value]="true">Desabilitado</option>
                              <option [value]="false">Habilitado</option>
                            </select>
                            <label for="floatingInput">Acesso</label>
                          </div>
                        </div>
                        <hr class="text-white-50" />
                        <div class="px-4">
                          <h4 class="fw-bold py-4 text-uppercase">SubItens</h4>
                          <div
                            formArrayName="itens"
                            *ngIf="getSubItemFormArray(m, i).length > 0"
                          >
                            <div
                              *ngFor="
                                let subItem of getSubItemFormArray(m, i);
                                let si = index
                              "
                              class="mb-4"
                            >
                              <ngb-accordion
                                #acc="ngbAccordion"
                                class="bg-primary"
                              >
                                <ngb-panel
                                  [title]="
                                    subItem.get('nome')!.value != ''
                                      ? subItem.get('nome')!.value
                                      : 'Novo SubItem ' + (si + 1)
                                  "
                                >
                                  <ng-template ngbPanelContent>
                                    <div
                                      class="d-flex justify-content-end px-4"
                                    >
                                      <button
                                        class="btn btn-outline-danger endButton"
                                        (click)="deleteSubItem(m, i, si)"
                                      >
                                        Deletar SubItem
                                      </button>
                                    </div>
                                    <div class="row px-4" [formGroupName]="si">
                                      <div
                                        class="form-floating form-group my-3 col-lg-5 col-md-12"
                                      >
                                        <input
                                          type="text"
                                          required
                                          maxlength="100"
                                          class="form-control text-black"
                                          id="floatingInput"
                                          placeholder="Jogo"
                                          formControlName="nome"
                                        />
                                        <label for="floatingInput">Nome</label>
                                      </div>
                                      <div
                                        class="form-floating form-group my-3 col-lg-5 col-md-12"
                                      >
                                        <input
                                          type="text"
                                          required
                                          maxlength="100"
                                          class="form-control text-black"
                                          id="floatingInput"
                                          placeholder="Jogo"
                                          formControlName="icone"
                                        />
                                        <label for="floatingInput">Icone</label>
                                      </div>
                                      <div
                                        class="form-floating form-group my-3 col-lg-7 col-md-12"
                                      >
                                        <input
                                          type="text"
                                          maxlength="100"
                                          class="form-control text-black"
                                          id="floatingInput"
                                          placeholder="Jogo"
                                          formControlName="path"
                                        />
                                        <label for="floatingInput">Link</label>
                                      </div>
                                      <div
                                        class="form-floating form-group my-3 col-lg-4 col-md-12"
                                      >
                                        <select
                                          class="form-select text-black"
                                          id="exampleSelect1"
                                          formControlName="ativo"
                                        >
                                          <option [value]="true">
                                            Desabilitado
                                          </option>
                                          <option [value]="false">
                                            Habilitado
                                          </option>
                                        </select>
                                        <label for="floatingInput"
                                          >Acesso</label
                                        >
                                      </div>
                                    </div>
                                  </ng-template>
                                </ngb-panel>
                              </ngb-accordion>
                            </div>
                          </div>
                          <div class="d-flex justify-content-end mt-5 px-4">
                            <button
                              class="btn btn-outline-primary endButton"
                              (click)="addSubItem(m, i)"
                            >
                              Adicionar SubItem
                            </button>
                          </div>
                        </div>
                      </ng-template>
                    </ngb-panel>
                  </ngb-accordion>
                </div>
              </div>
              <div class="d-flex justify-content-end mt-5 px-4">
                <button
                  class="btn btn-outline-primary endButton"
                  (click)="addItem(m)"
                >
                  Adicionar Item
                </button>
              </div>
            </div>
          </ng-template>
        </ngb-panel>
      </ngb-accordion>
    </div>
  </div>
  <div class="d-flex justify-content-end mt-5 px-4">
    <button class="btn btn-outline-primary endButton" (click)="addModulo()">
      Adicionar Modulo
    </button>
  </div>
  <hr class="text-white-50" />
  <div class="d-flex justify-content-end mt-5 px-4">
    <button class="btn btn-success endButton" (click)="save()">Enviar</button>
  </div>
</form>
